*) batch ingest bypasses normal islandora and will not generate derivitaves without messaging service

*) The source code is along side the class files in WEB-INF/classes

*) PCO access control based on OPEN_ or CLOSED_ mentioned in FedoraProxyIngest_2.pdf is not yet available.

*) TALK ABOUT GWT!!

*) Mention junit tests

*) Mention the last foxmlForIngest.xml file is always in the work directory

*) ALL email properites, except successEmail_2 must be filled out including emailFromAddress

*) remove all password and email info!


*****    Added years ago to edu.du.penrose.systems.fedoraApp.web.bus.security.LoginFedoraFormController        
System.setProperty( "javax.net.ssl.trustStore", "\\fedora\\client\\truststore" ); // TBD
            
System.setProperty( "javax.net.ssl.trustStorePassword", "tomcat" );

Perhaps it can be removed?
^^^^^^^^^^^^^^

     
*) Once you create a batchSpace directory tree, you normally not be putting files into it except for a batch file in the work dir or mets files with
a command line in the mets/new or mets/updates dir.

2) the the top of the batch file must look like this..

	<?xml version="1.0" encoding="UTF-8"?>
	<batch version="2">
	<ingestControl command="u" type="meta" />

3) Remote ingest files get "batch_" prepended and "_REMOTE" appended to them, so that only remote ingest task works with them.

4) The  <mets:dmdSec ID="dmdAlliance"> collection and pid in a batch file only works inside of a 'mixed' directory.

5) The mets/new mets/update directories are just for clarity, each file still needs an ingest command.
<!--<ingestControl command="u" type="meta" />-->  or <!--<ingestControl command="A" type="normal"/>-->

6) in the main batch file <ingestControl command="u" type="meta" /> becomes  <!--<ingestControl command="u" type="meta" /> --> 
     in the individual ingest file.

7) Collection and ContentModel can be set in two places 
   7a) the dmdSec of a 'mixed' tree
   7b) the batch_space/insitution/batchSet/batchSet.properties , You can set the propeties through the gui
   
8) The manual Fedora Administrator is different then the Remote administror. The manual is static in FedoraAppBatchIngest, the
    remote is static in IngestWorker
    
9) Need to check manual login immediately? by not checking it allows anyone to check status! a feature!!

10) Need to switch to fedora rest.


11) If in manual mode and simultaneous remote an manual is false and there is no remote task running, you must enable new batch or remote tasks will be disabled!!

12) If you force the stop of a remote ingest, you will not be able to re-enable it from the gui, if the remote is still enabled for the batchSet, 
I believe emails will get sent the next time the timer tasks runs since it will see the task as stopped, and then on the next timer run the task will 
be restarted!!  Disable the remote batchSet and then stop it with the gui!  To clear out the dead remote task, you must clear out all ingest files
and then temporarily enable remote ingest for the batchSet, the remote task should clear everything out. A page listing and controlling all
running tasks would be nice!

13) When you disable the allow_manual_and_remote_ingests in the batchIngest.properties file, you are only disabling the checkBox!! it wil 
continue to use the settings in the {batchSet}.proeprties file.

14) Batch files sent to fedoraProxy will be renamed with the current timestamp;

15) A Remote ingest needs three things.
   a) a batchSet_REMOTE.properies file
   b) enabled in taskEnable.properties
   c) Collection enabled in fedoraProxy websiteCollection.properties  SETTING THE COLLECTION IN FEDORAAPP DOES NOT SET THIS.

16) fedoraProxy checks for a valid command line and if good adds a 'batch_' prefix, _REMOTE.xml suffix before inserting into batch_space.../work directory
 
17) When doing an ADD OR AN UPDATE the datastreams are updated with label and handle, see this.updateXmlDatastreams( this.getAdministrator(), pid, xmlDocument );	

18) When upating the pid must be with the collection and start with the correct namespace (instituion ie codu:)
 
19) The institutiion MUST match the namespace, the batchSet does not have to match the collection name.

20) Since we update based on PID we test the namespace and the pid is the correct collection (specified in the {batchSet}_REMOTE.properites file. 

20b) For add we already have the correct name space (institution) since ask fedora for it by name, we have the correct collection since it came from the
user GUI or the {batchSet}_REMOTE.properties file UNLESS the {batchSet} == mixed when the <mets:dmdSec ID="dmdAlliance"> in each mets
file, it must exist and if wrong it is still restricted to the institution and the collection/contentModel must already exists.

21) back doors may exist so use a punched ip address for remote ingests.

22) On a remote ingest the system will try to send a rest response, if unable it will time out AND TRY AGAIN THE NEXT TIME THE TIMER RUNS to diable this
you need to set the restReplyHost or restReplyPort to empty

23) When doing a remote post, if the attached file already exists in the files directory, the post fails with an error, however when complete the file
will be moved to the completed files folder, overwriting any files of the same name.

24) For remote ingest the batch file must be in a "batch_" form part and end with either .zip or .xml. If zip the file is simply deposited
in the work folder with _REMOTE.zip . If .xml it is deposited with the xxxx_timestamp_REMOTE.xml. if the xml or zip file does not start with
 'batch_' is prepended (this is a requirement of fedoraApp)

25) If a failure occurs in a bagit extraction, the bagit directory will remain in the work dir.

26) A batch file name must contain a 'batch_' OR [_batch) string, this get put in automatically in a remote operation, and prepended to a bagit.zip file as
well, however the batch file inside the bag my not have the prefix, so this is added by the bag extractor.

27) The batch_ identifier is not needed if the batch file is selected manually?????

28)You can rename A bagit.zip file after it is created

*) tasks use the taskTemp directory, it takes two timer calls to process them, one to create and one to move them. If the task are turned
off with files in the taskTemp directory they will not get processed.

*) Only one command line per batch file!! all others are ignored.

*) Remove disable version 1 batch files?

*) You can just copy files to the mets/new or mets/update directory without a batch file, but each file must contain a command line
<!--<ingestControl command="u" type="meta" />-->

*) the correct way to shut down fedoraApp is disable remoteTasks in taskEnable.properties and then wait for all files in tasksTemp to
be processed.

*) The rest response happens AFTER the async ingest for files not after the posting.

*)
<mets:fileGrp ID="llama-alpaca-animal-face.jpg" USE="master"> 
      ID becomes the datastream id and USE becomes the  datastream label 
<mets:fptr FILEID="llama-alpaca-animal-face.jpg"></mets:fptr> 
     FILEID must match the fileGrp ID

*) SET HANDLE URL!!!!

*) If fedoraProxy is set up but fedoraApp does not have a {batchSet}_REMOTE.properties file, the batch file will be deposited in the 
batch_space but never processed, (as if remote ingests were turned off in taskEnable.properties)

*) Need to document When you have a bagit file, it assumes every .xml is a bath file. 'batch_' is prepended and it is moved to the work directory
BAGIT ***********

*) While files are failing you can't look at current log file *.csv *.txt in tasksTemp

	
*)	 * In fedroaApp, we handle existing files different for manual and remote ingest. For manual we throw an exception, for remote
	 * we add the FedoraAppConstants.DUPLICATE_FILE_SUFFIX and continue processing. This allows an external user the
	 * chance to recover from a failed ingest by posting a fixed bagit file with the same name. Otherwise someone would
	 * have to log onto the server to "fix" things.	 
	 The _DUPLICATE files are left in their directories, either work or files to make them visible. TBD'
	 
	 This is different then fedoraProxy, when doing a post that contains the actual PCOs (no bagit), if the PCO exists in the 
	 {institution}/{batchSet}/files directory,
	 a 500 error is thrown. We don't what to break an ingest that hasn't even started by posting another ingest with the same PCO
	 name.
	 
*) If 'Move Ingested PCOs to Completed Folder after Ingest.' is selected the PCO will be moved to the files dir with a unique timestamp
appended, along with _REMOTE appended if it is a remote ingest, The PCOs are NEVER DELETED!!

*) NEED TO REMOVE PASSWORDS, SERVERS  AND EMAIL SETTINGS!!!!

*) When emailing resutls for remote ingest the pid report is appended to the ingest report in a single email.

*) JMS is in the CODE BUT NOT USED AND NOT RECOMMENDED!!

*)_ Need to change the fedora namespace in the CreateReplyWithPid batch script

Bagit is the library and bagger is for gui, we use the bagit libraray and have the necessary bagger files in the src directory.
Since it is copied from the GUI bagit needs to init the json profiles it copies the profiles in src/gov/loc/repository/bagger/profiles 
(actually from the dir with compiled classes) to ~/bagger I created an empty profile so that it would be happy. You can then latter set
the profile in DefaultBag.setProfile() which I am not using in fedoraApp since we are doing an extract.


The bag is the only file posted, with a formPart name of 'batch_', it contains all PCOs and the batchfile itself. FedoraProxy.IngestController will put the
bag in the work directory.

The bagit extractor creates the bag in the work directory and transfers all files into this directory stucture, validate bad and then moves 
files to correct location and then deletes the bagit directory and moves the bagit file to completedBatchFile, keaving the batch file in 
work dir and the PCOs in the files dir.

If validation fails the *.zip file is moved to failedBatchFiles but the directory will remain, I think.

in the work folder you will first have a file of type...batch_bagit_8-3-2012_REMOTE.zip which will create a directory called bagit_8-3-2012
if ( zip file hasn't been renamed). then the files will be transfered, finally the batch file will be installed batch_B063_BatchIngest_08012012_REMOTE.xml
afterwhich normal batch process will begin. Both the zip and the batch file will end up in the completedBatchFiles directory.

*)  <mets:mdWrap MIMETYPE="text/xml" MDTYPE="MODS">  MDTYPE is used for the datastream id
The METS id is hard coded in metsToFOXml.xsl

*) TBD There is a potential problem with back ground tasks and email (only used by remote ingests). 
The first timer call performs the operation, the NEXT timer task after completion, sends the results 
email. If server dies in between it is possible that the email will not be sent. Need to consider using JMS.

*)install jms...activemq-all-5.5.0.jar xbean-spring-3.7.jar

*) REPORTS
edu.du.penrose.systems.fedoraApp.reports.PidReport
edu.du.penrose.systems.fedoraApp.reports.BatchIngestReport

*) solr search????? is in fedoraProxy


*) if a fatal error occurs (such as not being able to connect to fedora), everything stops and files are left where they they, if the error occurs in a remote ingest, ALL REMOTE INGESTS WILL BE DISABLED
 by updateing WEB-INF/config/taskEnable.properies file, an error will be written to the fedoraApp main.log file. FedoraProxy will still recieve batchs and queue them up in the batch_space file system.

*) If you can't login to fedora you can't login to fedoraApp to see status.

*) This system will hang forever if unable to login to Fedora or Download a bagit file, Howver the gui is updated and the user can abort the
operation.

*) Need to export source tree for FedoraApp fedoraProxy and BagitCreator

*) If remote ingests are disabled and allow simultaneus manual and remote ingest is not, you will not see an ingest button, only a save button!!
 
 *) When performing a manual batch ingest, first select institution, this comes from batch_space directory tree, you see that it is busy, this because
 app is querying resource index, looking for collections beneth {institution}:top, Note how the label is replaced with the actual pid, Below is 'please select'
 click on this to move back up. below please select are the next level of sub collections. you can then drill down into sub-COLLECTIONS collections must
 have a COLLECTION_POLICY to labeled as a collection. The app now looks for content models within listed in the COLLECTION_POLICY data stream of
 the collection.     <content_model dsid="ISLANDORACM" name="Electronic Thesis or Dissertation" namespace="codu:1" pid="codu:coduETD"></content_model>
 
) DURING TUTORIAL, send bagit.zip with bad server in host url () ..see error in status...delete bag from work dir, stop ingest in gui.
NEED TO ****************

cleanup batchIngest.properties

to replace GWT

a running thread screen.

speed up rels-ext


/**
						 * We have any information we need from the dmdAlliance section
						 * Remove any dmdAlliance section so that it does not get added to the foxml later on as a datastream, our xslt is out of date
						 * and rather then update the xslt we are going to do it programatically.
						 */




